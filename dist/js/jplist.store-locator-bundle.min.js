/**
 * jPList - jQuery Data Grid Controls
 * jPList Store Locator Bundle 5.2.0.20 - http://jplist.com
 * Copyright 2016 Miriam Zusin
 *
 * Free for non commercial use only
 * To use this file on commercial sites you should purchase a licence at http://jplist.com
 */
(function(){var d=function(b,a){for(var e,f=[],c=0;c<a.length;c++)e=a[c],e=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(e.$item),f.push(e);b.params.mapView.setStores(f)},c=function(b){b.observer.on(b.observer.events.collectionReadyEvent,function(a,e){b.params.dataitems=e.dataitems;d(b,b.params.dataitems)});b.observer.on(b.observer.events.statusesAppliedToList,function(a,e){b.params.dataview=e.dataview;d(b,b.params.dataview)});b.observer.on("jplist.map.store.clicked",function(a,e,f){b.params.mapView.showStore(e,
f,b.params.userSettings.storeZoom)})},g=function(b){b.params={userSettings:{},mapView:null,storesView:null,dataitems:[],dataview:[]};var a=b.params,e;e={latitude:Number(b.$control.attr("data-latitude"))||0,longitude:Number(b.$control.attr("data-longitude"))||0,initialZoom:Number(b.$control.attr("data-initil-zoom"))||2,mapTypeId:b.$control.attr("data-map-type")||"ROADMAP",storeZoom:Number(b.$control.attr("data-store-zoom"))||17,geolocation:"true"===b.$control.attr("data-geolocation"),openInfoWindowOnStoreClick:b.$control.attr("data-open-popup-store-click")||
!1,customMarkerIcon:b.$control.attr("data-marker-icon"),markerText:b.$control.attr("data-marker-text")||"Click to Zoom"};a.userSettings=e;b.params.mapView=new jQuery.fn.jplist.controls.GoogleMapsControl.MapView(b.params.userSettings,b.observer,b.$control);b.params.storesView=new jQuery.fn.jplist.controls.GoogleMapsControl.StoresView(b.params.userSettings,b.observer,b.$root.find(b.options.itemsBox),b.options.itemPath);c(b);return jQuery.extend(this,b)};jQuery.fn.jplist.controls.GoogleMapsControl=function(b){return new g(b)};
jQuery.fn.jplist.controlTypes["google-maps-control"]={className:"GoogleMapsControl",options:{}}})();(function(){var d=function(e,a){for(var b,c=0;c<e.stores.length;c++)b=e.stores[c],b.remove();e.stores=[];e.stores=a;if(e.mapCanvas)for(b=0;b<a.length;b++)c=a[b],c.marker=new jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel(e.observer,c.longitude,c.latitude,e.mapCanvas,e.userSettings.markerText,c.html)},c=function(b,a,c,d){a=new google.maps.LatLng(a,c);b.mapCanvas.setCenter(a);b.mapCanvas.setZoom(d)},g=function(b){for(var a=0;a<b.stores.length;a++)b.stores[a].closeStorePopup()},b=function(b){b.userSettings.geolocation&&
navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){c(b,a.coords.latitude,a.coords.longitude,b.userSettings.storeZoom)})},a=function(a){window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,"load",function(){var c;c=new google.maps.LatLng(a.userSettings.latitude,a.userSettings.longitude);a.mapCanvas=new window.google.maps.Map(a.$map.get(0),{mapTypeId:google.maps.MapTypeId[a.userSettings.mapTypeId],center:c,zoom:a.userSettings.initialZoom});d(a,a.stores);
b(a)});a.observer.on("jplist.map.marker.clicked",function(b,c,d){g(a)})};jQuery.fn.jplist.controls.GoogleMapsControl.MapView=function(b,c,d){this.userSettings=b;this.$map=d;this.observer=c;this.mapCanvas=null;this.stores=[];a(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showLocation=function(a,b,d){c(this,a,b,d)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showStore=function(a,b,d){var h;g(this);for(var k=0;k<this.stores.length;k++)if(h=this.stores[k],h.latitude===
a&&h.longitude===b){c(this,a,b,d);this.userSettings.openInfoWindowOnStoreClick&&h.openStorePopup();break}};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.setStores=function(a){d(this,a)}})();(function(){var d=function(c){c.$storesPanel.on("click",c.storePath,function(){var d=jQuery(this);c.$storesPanel.find(c.storePath).removeClass("jplist-active-store");d.addClass("jplist-active-store");c.observer.trigger("jplist.map.store.clicked",[Number(d.attr("data-latitude")),Number(d.attr("data-longitude"))])})};jQuery.fn.jplist.controls.GoogleMapsControl.StoresView=function(c,g,b,a){this.userSettings=c;this.observer=g;this.$storesPanel=b;this.storePath=a;d(this)}})();(function(){var d=function(c,d){var b;b=c.$store.find('[data-type="'+d+'"]');return 0<b.length?b.text():null};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel=function(c){this.marker=null;this.$store=c;this.latitude=Number(this.$store.attr("data-latitude"))||0;this.longitude=Number(this.$store.attr("data-longitude"))||0;this.html=c.html();this.title=d(this,"title");this.address=d(this,"address");this.city=d(this,"city");this.state=d(this,"state");this.zipcode=d(this,"zipcode");this.country=
d(this,"country")};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.openStorePopup=function(){this.marker&&this.marker.openPopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.closeStorePopup=function(){this.marker&&this.marker.closePopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.remove=function(){this.marker&&this.marker.remove()}})();(function(){var d=function(c){window.google.maps.event.addListener(c.gmarker,"click",function(d){c.observer.trigger("jplist.map.marker.clicked");c.gmarker.infowindow.open(c.map,c.gmarker)})};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel=function(c,g,b,a,e,f){this.position=new window.google.maps.LatLng(b,g);this.map=a;this.observer=c;this.title=e;this.gmarker=new window.google.maps.Marker({position:this.position,map:this.map,title:this.title});this.gmarker.infowindow=new window.google.maps.InfoWindow;
this.gmarker.infowindow.setContent('<div class="jplist-marker-popup">'+f+"</div>");d(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.openPopup=function(){window.google.maps.event.trigger(this.gmarker,"click")};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.closePopup=function(){this.gmarker&&this.gmarker.infowindow&&this.gmarker.infowindow.close()};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.remove=function(){this.gmarker.setMap(null)}})();(function(){jQuery.fn.jplist.FiltersService=jQuery.fn.jplist.FiltersService||{};jQuery.fn.jplist.FiltersService.autocompleteFilter=function(d,c,g,b,a){var e=[],f,l;if(jQuery.isNumeric(d)&&jQuery.isNumeric(c)&&window.google&&0<a){d=new google.maps.LatLng(d,c);for(var h=0;h<b.length;h++)c=b[h],f=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(c.jqElement),l=f.country?jQuery.trim(f.country.toLowerCase())==jQuery.trim(g.toLowerCase()):!1,f=new google.maps.LatLng(f.latitude,f.longitude),f=window.google.maps.geometry.spherical.computeDistanceBetween(d,
f),(f<=a||l)&&e.push(c);return e}return b}})();(function(){jQuery.fn.jplist.DTOMapperService=jQuery.fn.jplist.DTOMapperService||{};jQuery.fn.jplist.DTOMapperService.filters=jQuery.fn.jplist.DTOMapperService.filters||{};jQuery.fn.jplist.DTOMapperService.filters.AutocompleteFilter=function(d,c){return jQuery.fn.jplist.FiltersService.autocompleteFilter(d.data.latitude,d.data.longitude,d.data.name,c,d.data.radius)}})();(function(){var d=function(a){var b=g(a,!1);a.history.addStatus(b);a.observer.trigger(a.observer.events.knownStatusesChanged,[[b]])},c=function(a){a.params.handler&&window.google.maps.event.removeListener(a.params.handler);a.params.handler=window.google.maps.event.addListener(a.params.autocomplete,"place_changed",function(){a.params.place=a.params.autocomplete.getPlace();d(a)});a.$control.next('[data-type="clear"]').off("click").on("click",function(){a.$control.val("");a.params.place=null;d(a)});
a.$control.off("keyup").on("keyup",function(b){""===jQuery.trim(jQuery(this).val())&&(a.params.place=null,d(a))})},g=function(a,b){var c=null,c=b||!a.params.place?new jQuery.fn.jplist.controls.AutocompleteDTO(0,0,"",0):new jQuery.fn.jplist.controls.AutocompleteDTO(a.params.place.geometry.location.lat(),a.params.place.geometry.location.lng(),a.params.place.name,a.params.radius);return c=new jQuery.fn.jplist.StatusDTO(a.name,a.action,a.type,c,a.inStorage,a.inAnimation,a.isAnimateToTop,a.inDeepLinking)},
b=function(a){a.params={autocomplete:null,place:null,zoom:Number(a.$control.attr("data-zoom"))||17,radius:a.$control.attr("data-radius")};window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,"load",function(){a.params.autocomplete=new window.google.maps.places.Autocomplete(a.$control.get(0));c(a)});return jQuery.extend(this,a)};b.prototype.getStatus=function(a){return g(this,a)};jQuery.fn.jplist.controls.GoogleAutocompleteControl=function(a){return new b(a)};jQuery.fn.jplist.controlTypes["google-autocomplete-control"]=
{className:"GoogleAutocompleteControl",options:{}}})();(function(){jQuery.fn.jplist.controls.AutocompleteDTO=function(d,c,g,b){return{latitude:d,longitude:c,name:g,radius:b,filterType:"AutocompleteFilter"}}})();
